<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description"
    content="Buy high-quality oversized t-shirts in India. AsUsual offers trendy unisex graphic tees, cotton t-shirts for men & women. Free shipping on all orders. Shop now!" />
  <meta name="keywords"
    content="asusual, asusua, asusual clothing, oversized t shirts india, ASUSUAL clothing, graphic tees india, cotton t shirts online, trendy streetwear india, buy t shirts online india" />
  <title>Cart - Dark Theme</title>
  <!-- Favicons -->
  <link rel="icon" href="/assests/favicon.png" type="image/x-icon" sizes="any" />
  <link rel="icon" href="/assests/favicon.svg" type="image/svg+xml" />
  <link rel="apple-touch-icon" href="/assests/apple-touch-icon.png" />
  <link rel="manifest" href="/assests/site.webmanifest" />
  <meta name="theme-color" content="#ffffff" />
  <link rel="stylesheet" href="/styles/cart.css" />
  <link rel="stylesheet" href="/styles/bookingBtn.css" />
  <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="styles/styles.css" />
  <link rel="stylesheet" href="styles/footer.css" />
  <link rel="stylesheet" href="styles/navbar.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
  <style>
    .coupon-error {
      color: #ff4444;
      margin-top: 5px;
      font-size: 0.9em;
    }

    .coupon-success {
      color: #860505;
      margin-top: 5px;
      font-size: 0.9em;
    }

    .discount-message {
      color: #860505;
      font-size: 0.9em;
      margin-top: 5px;
    }

    .coupon-input-group {
      display: flex;
      margin-bottom: 10px;
    }

    #cart-code {
      flex: 1;
      padding: 8px;
      border: 1px solid #444;
      background: #222;
      color: #fff;
      border-radius: 4px 0 0 4px;
    }

    .apply-coupon-btn,
    .remove-coupon-btn {
      padding: 8px 12px;
      border: none;
      cursor: pointer;
    }

    .apply-coupon-btn {
      background: #860505;
      color: white;
      border-radius: 0 4px 4px 0;
    }

    .remove-coupon-btn {
      background: #f44336;
      color: white;
      border-radius: 0 4px 4px 0;
    }

    /* Order Controls */
    .order-controls {
      margin: 20px 0;
    }

    .proceed-btn {
      background: #860505;
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      width: 100%;
      transition: all 0.3s ease;
    }

    .shipping-form-container {
      background: #1e1e1e;
      padding: 20px;
      border-radius: 8px;
      margin-top: 15px;
      display: none;
      animation: fadeIn 0.3s ease-out;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .form-row {
      display: flex;
      gap: 15px;
      margin-bottom: 15px;
    }

    .form-group {
      flex: 1;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
      color: #ddd;
    }

    .form-group input {
      width: 100%;
      padding: 10px;
      border: 1px solid #444;
      background: #222;
      color: #fff;
      border-radius: 4px;
    }

    .form-actions {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: 20px;
    }

    .cancel-btn {
      background: #f44336;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 4px;
      cursor: pointer;
    }

    .submit-order-btn {
      background: #860505;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
    }

    /* Free item styling */
    .free-item {
      background: rgba(134, 5, 5, 0.1);
      border-left: 3px solid #4CAF50;
    }

    .free-badge {
      background: #4CAF50;
      color: white;
      padding: 2px 6px;
      border-radius: 3px;
      font-size: 0.7em;
      margin-left: 5px;
    }
  </style>
</head>

<body>
  <!-- Page Loader -->
  <div id="page-loader" class="page-loader">
    <h1 class="slide-in">AsUsual</h1>
    <div class="spinner"></div>
  </div>
  <!-- this is the responsive navbar -->

  <%- include('../partials/navbar', { user: user, cartCount: cartCount }) %>

  <div class="cart-container">
    <div class="cart-row">
      <div class="cart-items-section">
        <div class="cart-header">
          <h4><b>Shopping Cart</b></h4>
          <p>Welcome, <b>
              <%= user ? user.name : "Guest" %>
            </b></p>
        </div>

        <% if (cart && cart.items && cart.items.length> 0) { %>
          <div class="cart-header">
            <span class="cart-items-count">
              <%= cart.items.length %> items
            </span>
          </div>

          <% let subtotal=0; cart.items.forEach(item=> {
            if (item.product) {
            subtotal += item.product.price * item.quantity;
            %>
            <div class="cart-item" data-price="<%= item.product.price %>" data-product-id="<%= item.product._id %>"
              data-size="<%= item.size %>">
              <img class="cart-item-image" src="<%= item.product.front_image %>" alt="<%= item.product.name %>" />
              <div class="cart-item-details">
                <p class="cart-item-category">
                  <%= item.product.category %>
                </p>
                <p class="cart-item-name">
                  <%= item.product.name %>
                </p>
                <p class="cart-item-size">Size: <%= item.size %>
                </p>
                <p class="cart-item-color">Color: <%= item.color %>
                </p>
              </div>

              <div class="cart-item-price">
                Rs <span class="item-total">
                  <%= item.product.price * item.quantity %>
                </span>
                <span class="cart-remove" data-id="<%= item.product._id %>">&#10005;</span>
              </div>

              <div class="cart-item-quantity">
                <button class="decrease">-</button>
                <span class="cart-quantity">
                  <%= item.quantity %>
                </span>
                <button class="increase">+</button>
                <p class="quantity-message" style="display: none; color: #f44336; font-size: 0.8em; margin-top: 4px;">
                </p>
              </div>
            </div>
            <% } else { %>
              <p style="color: red">Product not found.</p>
              <% } %>
                <% }) %>

                  <!-- âœ… Free Item Section -->
                  <% if (cart.freeItem) { %>
                    <div class="cart-header" style="margin-top: 25px;">
                      <h5 style="color: #860505;"><b>Free Item (Offer Reward)</b></h5>
                    </div>

                    <div class="cart-item free-item" data-cart-id="<%= cart._id %>">
                      <img class="cart-item-image" src="<%= cart.freeItem.front_image %>"
                        alt="<%= cart.freeItem.name %>" />

                      <div class="cart-item-details">
                        <p class="cart-item-category">
                          <%= cart.freeItem.category %>
                        </p>
                        <p class="cart-item-name">
                          <%= cart.freeItem.name %> <span class="free-badge">FREE</span>
                        </p>

                        <div class="cart-item-size">
                          <label for="freeItemSize" style="font-weight: 500;">Size:</label>
                          <select id="freeItemSize" class="free-item-size">
                            <option value="">-- Select Size --</option>
                            <% if (cart.freeItem.availableSizes && cart.freeItem.availableSizes.length> 0) { %>
                              <% cart.freeItem.availableSizes.forEach(size=> { %>
                                <option value="<%= size %>" <%=cart.freeItemSize===size ? 'selected' : '' %>>
                                  <%= size %>
                                </option>
                                <% }) %>
                                  <% } else { %>
                                    <option value="One Size" selected>One Size</option>
                                    <% } %>
                          </select>
                        </div>
                      </div>

                      <div class="cart-item-price">
                        <span style="color:#4CAF50; font-weight: bold;">FREE</span>
                      </div>
                      <div class="cart-item-quantity">
                        <span class="cart-quantity">1</span>
                      </div>
                    </div>
                    <% } %>

                      <% } else { %>
                        <div class="empty-cart-message">
                          <p>No items in cart. Please continue shopping.</p>
                          <a href="/" class="continue-shopping-btn">Continue Shopping</a>
                        </div>
                        <% } %>

                          <div class="cart-back">
                            <a href="/">&leftarrow; Back to shop</a>
                          </div>
      </div>


      <% if (cart && cart.items && cart.items.length> 0) {
        // subtotal already calculated above
        let total = subtotal + deliveryCost - (discountAmount || 0);
        %>

        <div class="cart-summary">
          <h5><b>Summary</b></h5>
          <hr />
          <div class="summary-details">
            <p>ITEMS <span id="total-items">
                <%= cart.items.length %>
              </span></p>
            <p>Rs <span id="total-price">
                <%= subtotal.toFixed(2) %>
              </span></p>
          </div>

          <form id="coupon-form" action="/cart/apply-coupon" method="POST">
            <p style="margin-top: 18px">SHIPPING</p>
            <select>
              <option>
                Standard Delivery - Rs<%= deliveryCost.toFixed(2) %>
              </option>
            </select>

            <p style="margin-top: 15px">DISCOUNT CODE</p>
            <div class="coupon-input-group">
              <input id="cart-code" name="couponCode" placeholder="Enter your code"
                value="<%= cart.appliedCoupon ? cart.appliedCoupon.code || cart.appliedCoupon.name : '' %>" />
              <% if (!cart.appliedCoupon) { %>
                <button type="submit" class="apply-coupon-btn">Apply</button>
                <% } else { %>
                  <a href="/cart/remove-coupon" class="remove-coupon-btn">Remove</a>
                  <% } %>
            </div>

            <% if (cart.appliedCoupon) { %>
              <p class="coupon-success">
                <% if(cart.CouponType==='Coupon' ) { %>
                  Coupon: <b>
                    <%= cart.appliedCoupon.code %>
                  </b> -
                  <%= cart.appliedCoupon.discountType==='percentage' ? `${cart.appliedCoupon.discountValue}% off` :
                    `Rs${cart.appliedCoupon.discountValue} off` %>
                    <% if(cart.appliedCoupon.useonce) { %>
                      <br /><small>(One-time use coupon)</small>
                      <% } %>
                        <% } else if(cart.CouponType==='Offer' ) { %>
                          Offer: <b>
                            <%= cart.appliedCoupon.name %>
                          </b> -
                          <% if(cart.appliedCoupon.offerType==='flat_discount' ) { %>
                            Rs<%= cart.appliedCoupon.offerValue %> off
                              <% } else if(cart.appliedCoupon.offerType==='percentage_discount' ) { %>
                                <%= cart.appliedCoupon.offerValue %>% off
                                  <% } else if(cart.appliedCoupon.offerType==='free_item' ) { %>
                                    Free item added to cart
                                    <% } %>
                                      <% } %>
              </p>
              <% } %>

                <% if (message) { %>
                  <p class="<%= message.includes('successfully') ? 'coupon-success' : 'coupon-error' %>">
                    <%= message %>
                  </p>
                  <% } %>
          </form>
          <div class="summary-total">
            <div class="price-breakdown">
              <div class="price-line total-line">
                <span>TOTAL PRICE:</span>
                <span>Rs <%= (subtotal + deliveryCost - (discountAmount || 0)).toFixed(2) %></span>
              </div>
            </div>

            <% if (discountAmount> 0) { %>
              <p class="discount-message">
                You saved: Rs <%= discountAmount.toFixed(2) %>
              </p>
              <% } %>
          </div>

          <div class="order-controls">
            <button id="proceed-to-order" class="proceed-btn">
              Proceed to Order
            </button>

            <div id="shipping-form-container" class="shipping-form-container">
              <h5><b>Shipping Details</b></h5>
              <hr style="margin-bottom: 25px" />
              <form id="shipping-form">
                <div class="form-row">
                  <div class="form-group">
                    <label for="shipping-line1">Address Line 1*</label>
                    <input type="text" id="shipping-line1" name="line1" required />
                  </div>
                  <div class="form-group">
                    <label for="shipping-line2">Address Line 2</label>
                    <input type="text" id="shipping-line2" name="line2" />
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label for="shipping-city">City*</label>
                    <input type="text" id="shipping-city" name="city" required />
                  </div>
                  <div class="form-group">
                    <label for="shipping-state">State*</label>
                    <input type="text" id="shipping-state" name="state" required />
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label for="shipping-postalCode">Postal Code*</label>
                    <input type="text" id="shipping-postalCode" name="postalCode" maxlength="6" required />
                  </div>
                  <div class="form-group">
                    <label for="shipping-country">Country*</label>
                    <input type="text" id="shipping-country" name="country" required />
                  </div>
                </div>

                <div class="form-group">
                  <label for="shipping-contactNumber">Contact Number*</label>
                  <input type="text" id="shipping-contactNumber" name="contactNumber" maxlength="10" pattern="\d{10}"
                    required />
                </div>

                <div class="form-actions">
                  <button type="button" id="cancel-order" class="cancel-btn">
                    Cancel
                  </button>
                  <button class="order" id="cashfree-payment-btn" class="submit-order-btn">
                    <span class="default">Complete Order</span>
                    <span class="success">Order Placed
                      <svg viewbox="0 0 12 10">
                        <polyline points="1.5 6 4.5 9 10.5 1"></polyline>
                      </svg>
                    </span>
                    <div class="box"></div>
                    <div class="truck">
                      <div class="back"></div>
                      <div class="front">
                        <div class="window"></div>
                      </div>
                      <div class="light top"></div>
                      <div class="light bottom"></div>
                    </div>
                    <div class="lines"></div>
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
        <% } %>
    </div>
  </div>
  <!-- partial -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script>
    $(".order").click(function (e) {
      let button = $(this);

      if (!button.hasClass("animate")) {
        button.addClass("animate");
        setTimeout(() => {
          button.removeClass("animate");
        }, 10000);
      }
    });
  </script>

  <!-- footer  -->
<%- include('../partials/footer') %>


  <script src="/scripts/cart.js"></script>
  <script src="scripts/script.js"></script>
  <script src="https://unpkg.com/feather-icons"></script>
  <script>
    feather.replace();
  </script>

  <script>
    window.addEventListener("load", function () {
      const loader = document.getElementById("page-loader");
      if (loader) {
        loader.classList.add("fade-out");
        setTimeout(() => (loader.style.display = "none"), 500);
      }
    });
  </script>

  <script src="https://sdk.cashfree.com/js/v3/cashfree.sandbox.js"></script>
  <!-- OR for live -->
  <!-- <script src="https://sdk.cashfree.com/js/v3/cashfree.js"></script>  -->
</body>

</html>