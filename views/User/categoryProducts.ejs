<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description"
        content="Buy <%= categoryName %> collection from AsUsual. Premium oversized t-shirts and streetwear clothing for men & women in India.">
    <meta name="keywords"
        content="asusual, asusual clothing, <%= categoryName %>, t-shirts, oversized tees, streetwear india">
    <title>
        <%= categoryName %> - AsUsual
    </title>

    <link rel="icon" href="/assests/favicon.png" type="image/x-icon" sizes="any">
    <link rel="icon" href="/assests/favicon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/assests/apple-touch-icon.png">
    <meta name="theme-color" content="#ffffff">

    <link rel="stylesheet" href="/styles/allProduct.css" />
    <link rel="stylesheet" href="/styles/styles.css" />
    <link rel="stylesheet" href="/styles/footer.css" />
    <link rel="stylesheet" href="/styles/navbar.css" />

    <style>
        .category-header {
            position: relative;
            width: 100%;
            padding: 60px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(2.2rem, 6vw, 4rem);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 3px;
            background: #000;
            color: #e60023;
            /* sleek red */
            overflow: hidden;
            font-family: 'Poppins', sans-serif;
        }

        /* Minimal red glow */
        .category-header::before {
            content: attr(data-category);
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #e60023;
            opacity: 0.2;
            filter: blur(8px);
        }

        /* Soft underline reveal */
        .category-header span {
            position: relative;
        }

        .category-header span::after {
            content: "";
            position: absolute;
            left: 50%;
            bottom: -8px;
            width: 0;
            height: 2px;
            background: #e60023;
            transform: translateX(-50%);
            transition: width 0.6s ease;
        }

        /* Animate underline on page load */
        .category-header.loaded span::after {
            width: 60%;
        }

        /* Shadow Flash / Glitch back layer */
        .category-header::after {
            content: attr(data-category);
            position: absolute;
            color: rgba(255, 0, 0, 0.2);
            font-size: inherit;
            transform: translate(3px, 3px);
            filter: blur(3px);
        }
        /* OPTIONAL — subtle scanline flicker */
        .category-header::before {
            animation:
                pulseGlow 2.2s ease-in-out infinite,
                flicker 4s linear infinite;
        }

        @keyframes flicker {
            0% {
                opacity: 1;
            }

            5% {
                opacity: 0.85;
            }

            10% {
                opacity: 1;
            }

            15% {
                opacity: 0.9;
            }

            20% {
                opacity: 1;
            }

            30% {
                opacity: 0.95;
            }

            80% {
                opacity: 1;
            }

            100% {
                opacity: 0.9;
            }
        }


        /* Optional background overlay pattern */
        .category-header::before,
        .category-header::after {
            font-size: inherit;
            font-weight: inherit;
            text-transform: inherit;
            letter-spacing: inherit;
        }

        .card::after {
            content: "ASUSUAL";
            position: absolute;
            bottom: 0;
            left: 3px;
            font-weight: 600;
            font-size: 3.8rem;
            color: rgba(255, 255, 255, 0.1);
        }

        .card .contentBox .buy {

            margin-top: 10px;
        }
    </style>

</head>

<body>
    <!-- Loader -->
    <div id="page-loader" class="page-loader">
        <h1 class="slide-in">AsUsual</h1>
        <div class="spinner"></div>
    </div>

    <!-- Navbar -->
    <%- include('../partials/navbar', { user: user, cartCount: cartCount }) %>

        <!-- Category Header -->
        <div class="category-header" data-category="<%= categoryName %>">
            <span>
                <%= categoryName %>
            </span>
        </div>

        <div class="All-product-container">
            <!-- Filters -->
            <div class="filters">
                <details>
                    <summary>Filters</summary>
                    <div class="other-filter">
                        <!-- Price -->
                        <div class="slider-container">
                            <label for="price-range">Price Range:</label>
                            <input type="range" id="price-range" min="0" max="5000" step="100" value="5000"
                                oninput="updatePrice(this.value)" />
                            <div class="slider-values">
                                <span>₹1</span>
                                <span id="price-value">5000</span>
                                <span>₹5000</span>
                            </div>
                        </div>

                        <!-- Sizes -->
                        <div class="collapse">
                            <h3 onclick="toggleCollapse('sizes')">Sizes</h3>
                            <div class="collapse-content" id="sizes">
                                <% ['xsmall','small','medium','large','xlarge','xxlarge'].forEach((sz,i)=>{ %>
                                    <div class="checkbox-group">
                                        <input type="checkbox" id="size<%= i %>" value="<%= sz %>" />
                                        <label for="size<%= i %>">
                                            <%= sz.toUpperCase().replace('X','X ') %></label>
                </div>
              <% }) %>
            </div>
          </div>

          <!-- Colors -->
          <div class="collapse">
            <h3 onclick="toggleCollapse(' colors')">Colors</h3>
                                                <div class="collapse-content" id="colors">
                                                    <% if (availableColors && availableColors.length> 0) { %>
                                                        <% availableColors.forEach((color, index)=> { %>
                                                            <div class="checkbox-group">
                                                                <input type="checkbox" id="color<%= index %>"
                                                                    value="<%= color %>">
                                                                <label for="color<%= index %>">
                                                                    <%= color.charAt(0).toUpperCase() + color.slice(1)
                                                                        %>
                                                                </label>
                                                            </div>
                                                            <% }) %>
                                                                <% } else { %>
                                                                    <p>No color options available</p>
                                                                    <% } %>
                                                </div>
                                    </div>

                                    <!-- Sort -->
                                    <div class="collapse">
                                        <h3 onclick="toggleCollapse('sort-order')">Sort by</h3>
                                        <div class="collapse-content" id="sort-order">
                                            <h4>Price</h4>
                                            <div class="radio-group">
                                                <input type="radio" id="sort-asc" name="sort-price" value="asc" checked>
                                                <label for="sort-asc">Low to High</label>
                                            </div>
                                            <div class="radio-group">
                                                <input type="radio" id="sort-desc" name="sort-price" value="desc">
                                                <label for="sort-desc">High to Low</label>
                                            </div>
                                            <h4>Name</h4>
                                            <div class="radio-group">
                                                <input type="radio" id="sort-name-asc" name="sort-name" value="asc">
                                                <label for="sort-name-asc">A to Z</label>
                                            </div>
                                            <div class="radio-group">
                                                <input type="radio" id="sort-name-desc" name="sort-name" value="desc">
                                                <label for="sort-name-desc">Z to A</label>
                                            </div>
                                        </div>
                                    </div>
                            </div>
                </details>
                <button class="apply-filters" onclick="applyFilters()">Apply Filters</button>
            </div>

            <!-- Products -->
            <div class="products" id="product-list">
                <% if (products && products.length> 0) { %>
                    <% products.forEach(product=> { %>
                        <div class="card" data-url="/products/<%= product._id || product.id %>">
                            <div class="imgBox">
                                <div class="front">
                                    <img src="<%= product.front_image %>" alt="<%= product.name %>" class="mouse"
                                        loading="lazy" />
                                </div>
                                <div class="back">
                                    <img src="<%= product.back_image %>" alt="<%= product.name %>" class="mouse"
                                        loading="lazy" />
                                </div>
                            </div>
                            <div class="contentBox">
                                <h3>
                                    <%= product.name %>
                                </h3>
                                <h2 class="price"><small>Rs.</small>
                                    <%= product.price %>
                                </h2>
                                <a href="/products/<%= product._id || product.id %>" class="buy">Buy Now</a>
                            </div>
                        </div>
                        <% }) %>
                            <% } else { %>
                                <p>No products available in this category.</p>
                                <% } %>
            </div>
        </div>

        <%- include('../partials/footer') %>

            <!-- Scripts -->
            <script>
                let allProducts = [];
                try { allProducts = <% - JSON.stringify(products) %>; } catch { allProducts = []; }

                function updatePrice(v) { document.getElementById('price-value').innerText = `₹${v}`; }
                function toggleCollapse(id) { const el = document.getElementById(id); if (el) el.style.display = el.style.display === 'none' ? 'block' : 'none'; }

                function setupMobileNavigation() {
                    const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
                    document.querySelectorAll('#product-list .card').forEach(card => {
                        if (isMobile) {
                            let flipped = false, timer = null;
                            card.addEventListener('click', e => {
                                if (e.target.closest('.buy')) return;
                                if (!flipped) {
                                    card.classList.add('flipped');
                                    flipped = true;
                                    timer = setTimeout(() => { card.classList.remove('flipped'); flipped = false; }, 1000);
                                } else window.location.href = card.dataset.url;
                            });
                        } else {
                            card.addEventListener('mouseenter', () => card.classList.add('flipped'));
                            card.addEventListener('mouseleave', () => card.classList.remove('flipped'));
                            card.addEventListener('click', e => {
                                if (e.target.closest('.buy')) return;
                                window.location.href = card.dataset.url;
                            });
                        }
                    });
                }

                function applyFilters() {
                    const maxPrice = parseInt(document.getElementById('price-range').value) || 5000;
                    const selectedColors = Array.from(document.querySelectorAll('#colors input:checked')).map(c => c.value.toLowerCase());
                    const selectedSizes = Array.from(document.querySelectorAll('#sizes input:checked')).map(c => c.value);
                    const sortPrice = document.querySelector('input[name="sort-price"]:checked')?.value;
                    const sortName = document.querySelector('input[name="sort-name"]:checked')?.value;

                    let filtered = [...allProducts].filter(p => {
                        const priceOK = p.price <= maxPrice;
                        const colorOK = selectedColors.length === 0 || (p.color && p.color.some(c => selectedColors.includes(c.toLowerCase())));
                        const sizeOK = selectedSizes.length === 0 || selectedSizes.some(sz => p.sizes?.[sz] > 0);
                        return priceOK && colorOK && sizeOK;
                    });

                    if (sortPrice) filtered.sort((a, b) => sortPrice === 'asc' ? a.price - b.price : b.price - a.price);
                    if (sortName) filtered.sort((a, b) => {
                        const nameA = a.name.toLowerCase(), nameB = b.name.toLowerCase();
                        return sortName === 'asc' ? nameA.localeCompare(nameB) : nameB.localeCompare(nameA);
                    });

                    renderProducts(filtered);
                }

                function renderProducts(list) {
                    const container = document.getElementById('product-list');
                    container.innerHTML = '';
                    if (list.length === 0) { container.innerHTML = '<p>No matching products.</p>'; return; }
                    list.forEach(p => {
                        container.innerHTML += `
          <div class="card" data-url="/products/${p._id || p.id}">
            <div class="imgBox">
              <div class="front"><img src="${p.front_image}" alt="${p.name}" loading="lazy"/></div>
              <div class="back"><img src="${p.back_image}" alt="${p.name}" loading="lazy"/></div>
            </div>
            <div class="contentBox">
              <h3>${p.name}</h3>
              <h2 class="price"><small>Rs.</small>${p.price}</h2>
              <a href="/products/${p._id || p.id}" class="buy">Buy Now</a>
            </div>
          </div>`;
                    });
                    setupMobileNavigation();
                }

                document.addEventListener('DOMContentLoaded', () => {
                    setupMobileNavigation();
                    updatePrice(document.getElementById('price-range').value);
                    document.querySelectorAll('input').forEach(inp => inp.addEventListener('change', applyFilters));
                });
            </script>

            <script src="https://unpkg.com/feather-icons"></script>
            <script>feather.replace();</script>
            <script>
                window.addEventListener("load", function () {
                    const loader = document.getElementById("page-loader");
                    if (loader) { loader.classList.add("fade-out"); setTimeout(() => loader.style.display = "none", 500); }
                });
            </script>
            <script>
                window.addEventListener("load", () => {
                    document.querySelector(".category-header")?.classList.add("loaded");
                });
            </script>

</body>

</html>