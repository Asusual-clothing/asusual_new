<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description"
    content="Buy high-quality oversized t-shirts in India. AsUsual offers trendy unisex graphic tees, cotton t-shirts for men & women. Free shipping on all orders. Shop now!">
  <meta name="keywords"
    content="asusual, asusua, asusual clothing, oversized t shirts india, ASUSUAL clothing, graphic tees india, cotton t shirts online, trendy streetwear india, buy t shirts online india">
  <title>Your Orders</title>
  <!-- Favicons -->
  <link rel="icon" href="/assests/favicon.png" type="image/x-icon" sizes="any">
  <link rel="icon" href="/assests/favicon.svg" type="image/svg+xml">
  <link rel="apple-touch-icon" href="/assests/apple-touch-icon.png">
  <link rel="manifest" href="/assests/site.webmanifest">
  <meta name="theme-color" content="#ffffff">


  <link rel="stylesheet" href="/styles/styles.css">
  <link rel="stylesheet" href="/styles/footer.css">
  <link rel="stylesheet" href="/styles/navbar.css">
  <link rel="stylesheet" href="/styles/allorder.css">
  <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
</head>

<body class="app">
  <!-- Page Loader -->
  <div id="page-loader" class="page-loader">
    <h1 class="slide-in">AsUsual</h1>
    <div class="spinner"></div>
  </div>
  <!-- Navbar -->

  <%- include('../partials/navbar', { user: user, cartCount: cartCount }) %>

    <main class="orders-section">
      <% if (orders.length===0) { %>
        <div class="no-orders">
          <p class="no-orders-text">You have no orders yet.</p>
          <a href="/products" class="shop-btn">Start Shopping</a>
        </div>
        <% } else { %>
          <div class="orders-list">
            <% orders.forEach(order=> { %>
              <div class="order-card">
                <div class="order-header">
                  <div class="order-info">
                    <h3>Order #: <span class="order-id">
                        <%= order._id %>
                      </span></h3>
                    <p class="order-status">
                      <span class="status-label">Delivery Status:</span>
                      <span class="status-<%= order.status %>">
                        <%= order.status %>
                      </span>
                    </p>
                  </div>
                  <div class="order-meta">
                    <p class="order-date">Order Date: <%= new Date(order.createdAt).toLocaleString() %>
                    </p>
                    <p class="order-total">Total: <span class="total-amount">‚Çπ<%= order.totalAmount.toFixed(2) %></span>
                    </p>
                    <p class="payment-status">
                      <span class="status-label">Payment Status:</span>
                      <span class="status-<%= order.paymentStatus.toLowerCase() %>">
                        <%= order.paymentStatus %>
                      </span>
                  </div>
                </div>

                <div class="order-items">
                  <h4 class="items-title">Items</h4>
                  <div class="items-list">
                    <% order.items.forEach(item=> { %>
                      <div class="order-item">
                        <% if (item.product) { %>
                          <img src="<%= item.product.images[0] %>" alt="<%= item.product.name %>" class="item-image" />
                          <% } else { %>
                            <div class="item-image-placeholder">
                              <i class="fas fa-box-open"></i>
                            </div>
                            <% } %>
                              <div class="item-details">
                                <p class="item-name">
                                  <%= item.product ? item.product.name : 'Item not found' %>
                                </p>
                                <div class="item-meta">
                                  <p><span class="meta-label">Size:</span>
                                    <%= item.size %>
                                  </p>
                                  <p><span class="meta-label">Color:</span>
                                    <%= item.color %>
                                  </p>
                                  <p><span class="meta-label">Qty:</span>
                                    <%= item.quantity %>
                                  </p>
                                  <p><span class="meta-label">Price:</span> ‚Çπ<%= item.priceAtPurchase.toFixed(2) %>
                                  </p>
                                </div>
                              </div>
                      </div>
                      <% }) %>

                        <% if (order.freeItem) { %>
                          <div class="order-item free-item">
                            <% if (order.freeItem.images?.length> 0) { %>
                              <img src="<%= order.freeItem.images[0] %>" alt="<%= order.freeItem.name %>"
                                class="item-image" />
                              <% } else { %>
                                <div class="item-image-placeholder">
                                  <i class="fas fa-gift"></i>
                                </div>
                                <% } %>
                                  <div class="item-details">
                                    <p class="item-name">
                                      üéÅ <%= order.freeItem.name %> (Free Item)

                                    </p>
                                    <div class="item-meta">
                                      <p><span class="meta-label">Size:</span>
                                        <%= order.freeItemSize %>
                                      </p>
                                      <p><span class="meta-label">Price:</span> ‚Çπ0.00 (Free)</p>


                                    </div>
                                  </div>
                          </div>
                          <% } %>
                  </div>

                </div>

                <div class="order-footer">
                  <% const allProductsAvailable=order.items.every(item=> item.product); %>
                    <% if (allProductsAvailable) { %>
                      <a href="/orders/all-orders/<%= order._id.toString() %>" class="details-btn">
                        View Details
                      </a>
                      <% } else { %>
                        <span class="details-btn disabled-btn" title="Some items are no longer available">
                          View Details Unavailable
                        </span>
                        <% } %>
                </div>
              </div>
              <% }) %>
          </div>
          <% } %>
    </main>

    <!-- Footer -->
    <%- include('../partials/footer') %>

      <script src="scripts/script.js"></script>
      <script src="https://unpkg.com/feather-icons"></script>
      <script>
        feather.replace();
      </script>
      <script>
        const AsHamburger = document.querySelector('.As-hamburger');
        const AsNavLinks = document.querySelector('.As-nav-links');

        AsHamburger.addEventListener('click', () => {
          AsNavLinks.classList.toggle('active');
        });
        // Function to handle size selection
        function selectSize(size) {
          const selectedSizeInput = document.getElementById("selected-size");
          selectedSizeInput.value = size;

          // Highlight the selected size button
          document.querySelectorAll(".size-button").forEach(button => {
            button.classList.remove("selected");
          });
          document.querySelector(`.size-button[data-size="${size}"]`).classList.add("selected");
        }

        // Add event listeners to size buttons
        document.querySelectorAll(".size-button").forEach(button => {
          button.addEventListener("click", () => {
            const size = button.getAttribute("data-size");
            selectSize(size);
          });
        });

        // Function to change quantity
        function changeQuantity(change) {
          const quantityInput = document.getElementById('quantity');
          const displayInput = document.getElementById('quantityDisplay');
          let current = parseInt(quantityInput.value);
          if (current <= 1 && change === -1) return;
          current += change;
          quantityInput.value = current;
          displayInput.value = current;
        }


        // Function to validate form submission
        document.querySelector("form").addEventListener("submit", function (event) {
          const selectedSize = document.getElementById("selected-size").value;
          const quantity = parseInt(document.getElementById("quantity").value);

          if (!selectedSize) {
            event.preventDefault();
            alert("Please select a size before adding to cart.");
            return;
          }

          if (isNaN(quantity) || quantity < 1) {
            event.preventDefault();
            alert("Please select a valid quantity.");
          }
        });

        // Function to toggle product images
        function toggleImage(index) {
          const displayImage = document.querySelector(".display_image img");
          displayImage.src = document.querySelectorAll(".change_image img")[index].src;
        }

        // Initially, show the first image
        toggleImage(0);

        // Add event listeners to change image when clicked
        document.querySelectorAll(".change_image img").forEach((img, index) => {
          img.addEventListener("click", () => {
            toggleImage(index);
          });
        });
      </script>

</body>

</html>